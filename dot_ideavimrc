source ~/.vimrc

if has('ide')
	set history=1000
	" Fixed the problem that p paste cannot import class automatically, https://youtrack.jetbrains.com/issue/VIM-25/VIM-code-paste-should-be-smarter
	set clipboard+=ideaput,unnamed
	" Smart join for <C-J>
	set ideajoin
	set ideamarks
	set idearefactormode=keep
	" Ideavim Extension for switching to English in normal"
	set keep-english-in-normal
	" Ideavim Extension for switching to English in normal"

	" Ideavim Extension for highligting unique characters in line
	set quickscope

	" Ideavim Extension for displaying keymap info https://github.com/TheBlob42/idea-which-key
	set which-key
	set notimeout
	set timeoutlen=3000

	" Config manipulations
	nnoremap \e :e ~/.ideavimrc<CR>
	nnoremap \r :action IdeaVim.ReloadVimRc.reload<CR>
	" Config manipulations

	" Focus last buffer
	nnoremap <leader><Tab>    <C-S-6>
	vnoremap <leader><Tab>    <Esc><C-S-6>

	" Open in terminal
	nnoremap <leader>te    :action Terminal.OpenInTerminal<CR>
	vnoremap <leader>te    :action Terminal.OpenInTerminal<CR>

	nnoremap <leader>tt    :action ActivateTerminalToolWindow<CR>
	vnoremap <leader>tt    :action ActivateTerminalToolWindow<CR>

	nnoremap <leader>*    :action ShowUsages<CR>
	vnoremap <leader>*    :action ShowUsages<CR>

	" Project save
	nnoremap <leader>ps    :action SaveAll<CR>
	vnoremap <leader>ps    :action SaveAll<CR>

	" Copy project file path
	nnoremap <leader>pfy    :action CopyAbsolutePath<CR>
	vnoremap <leader>pfy    :action CopyAbsolutePath<CR>

	" Project new file
	nnoremap <leader>pfn    :action NewElementMenu<CR>
	vnoremap <leader>pfn    :action NewElementMenu<CR>

	" -- Errors --

	" Go to next error
	nnoremap <leader>en    :action GotoNextError<CR>
	vnoremap <leader>en    <Esc>:action GotoNextError<CR>

	" Go to previous error
	nnoremap <leader>ep    :action GotoPreviousError<CR>
	vnoremap <leader>ep    <Esc>:action GotoPreviousError<CR>

	" -- Errors --
	

	" -- Git --

	" Git clone
	nnoremap <leader>gc    :action Git.Clone<CR>
	vnoremap <leader>gc    :action Git.Clone<CR>

	" Show log of current file
	nnoremap <leader>gfl    :action Vcs.ShowTabbedFileHistory<CR>
	vnoremap <leader>gfl    :action Vcs.ShowTabbedFileHistory<CR>
	""" ---------------------------------------------

	" Annotate. Show when each line was last edited and by whom.
	nnoremap <leader>ga    :action Annotate<CR>
	vnoremap <leader>ga    :action Annotate<CR>

	" -- Git --
	

	" -- Changes --

	" Collapse all folds
	nnoremap zm    :action CollapseAllRegions<CR>
	vnoremap zm    :action CollapseAllRegions<CR>

	" Open all folds
	nnoremap zr    :action ExpandAllRegions<CR>
	vnoremap zr    :action ExpandAllRegions<CR>

	" -- Changes --


	" -- Numbers --

	" Increment number.
	" As usual you can press '.' to repeat this action again.
	nnoremap <leader>n+    <C-a>
	vnoremap <leader>n+    <C-a>
	nnoremap <leader>n=    <C-a>
	vnoremap <leader>n=    <C-a>

	" Decrement number.
	" As usual you can press '.' to repeat this action again.
	nnoremap <leader>n-    <C-x>
	vnoremap <leader>n-    <C-x>

	" -- Numbers --
	

	" -- Windows  --

	" Split window right
	nnoremap <leader>w/    :action SplitVertically<CR>
	vnoremap <leader>w/    <Esc>:action SplitVertically<CR>
	nnoremap <leader>wv    :action SplitVertically<CR>
	vnoremap <leader>wv    <Esc>:action SplitVertically<CR>

	" Split window below
	nnoremap <leader>w-    :action SplitHorizontally<CR>
	vnoremap <leader>w-    <Esc>:action SplitHorizontally<CR>
	nnoremap <leader>ws    :action SplitHorizontally<CR>
	vnoremap <leader>ws    <Esc>:action SplitHorizontally<CR>

	" Close window
	nnoremap <leader>wd    :action CloseAllEditors<CR>
	vnoremap <leader>wd    <Esc>:action CloseAllEditors<CR>
	nnoremap <leader>wx    :action CloseAllEditors<CR>
	vnoremap <leader>wx    <Esc>:action CloseAllEditors<CR>

	" Focus window left
	nnoremap <leader>wh         <C-w>h
	vnoremap <leader>wh         <Esc><C-w>h
	nnoremap <leader>w<Left>    <C-w>h
	vnoremap <leader>w<Left>    <Esc><C-w>h

	" Focus window down
	nnoremap <leader>wj         <C-w>j
	vnoremap <leader>wj         <Esc><C-w>j
	nnoremap <leader>w<Down>    <C-w>j
	vnoremap <leader>w<Down>    <Esc><C-w>j

	" Focus window up
	nnoremap <leader>wk       <C-w>k
	vnoremap <leader>wk       <Esc><C-w>k
	nnoremap <leader>w<Up>    <C-w>k
	vnoremap <leader>w<Up>    <Esc><C-w>k

	" Focus window right
	nnoremap <leader>wl          <C-w>l
	vnoremap <leader>wl          <Esc><C-w>l
	nnoremap <leader>w<Right>    <C-w>l
	vnoremap <leader>w<Right>    <Esc><C-w>l

	" Split window below and focus
	nnoremap <leader>wS    <C-w>s<C-w>j
	vnoremap <leader>wS    <Esc><C-w>s<C-w>j

	" Split window right and focus
	nnoremap <leader>wV    <C-w>v<C-w>l
	vnoremap <leader>wV    <Esc><C-w>v<C-w>l

	" Focus next window
	nnoremap <leader>ww    :action NextSplitter<CR>
	vnoremap <leader>ww    <Esc>:action NextSplitter<CR>
	
	" -- Windows  --
	
	" -- Zoom  --

	" Increase font size
	nnoremap <leader>zx+    :action EditorIncreaseFontSize<CR>
	vnoremap <leader>zx+    :action EditorIncreaseFontSize<CR>
	nnoremap <leader>zx=    :action EditorIncreaseFontSize<CR>
	vnoremap <leader>zx=    :action EditorIncreaseFontSize<CR>

	" Decrease font size
	nnoremap <leader>zx-    :action EditorDecreaseFontSize<CR>
	vnoremap <leader>zx-    :action EditorDecreaseFontSize<CR>

	" Reset font size
	nnoremap <leader>zx0    :action EditorResetFontSize<CR>
	vnoremap <leader>zx0    :action EditorResetFontSize<CR>

	" -- Zoom  --

	" IDE menus
	map <leader>mg <Action>(Git.MainMenu)
	nmap <leader>mc <Action>(CodeMenu)
	nmap <leader>mw <Action>(ToolWindowsGroup)

	map <leader>mp <Action>(ManageRecentProjects)
	map <leader>mn <Action>(ActivatenpmToolWindow)
	map <leader>mv <Action>(ActivateProjectToolWindow)
	map <leader>ml <Action>(SelectInProjectView)

	map <leader>mz <Action>(ToggleZenMode)

	map <leader>mr <Action>(ChooseRunConfiguration)
	map <leader>mR <Action>(RunClass)
	map <leader>md <Action>(ChooseDebugConfiguration)
	map <leader>mD <Action>(DebugClass)

	map <leader>ms <Action>(SelectIn)
	map <leader>mm <Action>(osmedile.intellij.stringmanip.PopupChoiceAction)

	map <leader>mo <Action>(FileStructurePopup)
	map <leader>mu <Action>(CallHierarchy)

	map <leader>mh <Action>(LocalHistory.ShowHistory)

	" Menu of bookmarks
	nnoremap <leader>mb    :action ShowBookmarks<CR>
	vnoremap <leader>mb    :action ShowBookmarks<CR>


	" Bookmarks
	map <leader>bn <Action>(GotoNextBookmark)
	map <leader>bp <Action>(GotoPreviousBookmark)
	map <leader>bb <Action>(ToggleBookmark)

	" IDE menus

	" Hover mapping
	map gj <Action>(ShowErrorDescription)
	map gh <Action>(ShowHoverInfo)
	map gt <Action>(QuickTypeDefinition)
	map ge <Action>(EditSource)
	" map ge <Action>(Documentation.EditSource)

	" Find action
	nnoremap <leader>fa    :action GotoAction<CR>
	vnoremap <leader>fa    :action GotoAction<CR>

	" Find file
	nnoremap <leader>ff    :action GotoFile<CR>
	vnoremap <leader>ff    :action GotoFile<CR>

	" Find in path (globally)
	nnoremap <leader>fg    :action FindInPath<CR>
	vnoremap <leader>fg    :action FindInPath<CR>

	" Find symbol
	nnoremap <leader>fs    :action GotoSymbol<CR>
	vnoremap <leader>fs    :action GotoSymbol<CR>

	" Refactoring
	map <leader>rn <Action>(RenameElement)
	map <leader>rf :action RenameFile<CR>
	map <leader>rr <Action>(ReformatCode)
	map <leader>rR <Action>(ReformatWithPrettierAction)
	map <leader>re <Action>(Javascript.Linters.EsLint.Fix)
	map <leader>rs <Action>(Stylelint.Fix)
	map <leader>ri <Action>(OptimizeImports)
	map <leader>rt <Action>(Refactorings.QuickListPopupAction)
	map <leader>rl <Action>(EditorSortLines)
	" Refactoring
	"
	" Comments

	vmap gcb <Action>(CommentByBlockComment)

	" Move text up and down.
	" nnoremap <A-Up> :m .-2<CR>==
	" nnoremap <A-Down> :m .+1<CR>==
	" inoremap <A-Up> <Esc>:m .-2<CR>==gi
	" inoremap <A-Down> <Esc>:m .+1<CR>==gi
	" NOTE It's not the same as using Vim's Ex-commands.
	nmap <A-Up> <Action>(MoveStatementUp)
	nmap <A-Down> <Action>(MoveStatementDown)
	imap <A-Up> <Action>(MoveStatementUp)
	imap <A-Down> <Action>(MoveStatementDown)
	vmap <A-Up> <Action>(MoveStatementUp)
	vmap <A-Down> <Action>(MoveStatementDown)

	" built-in navigation to navigated items works better
	nmap <c-o> <Action>(Back)
	nmap <c-i> <Action>(Forward)
	" but preserve ideavim defaults
	nnoremap g<c-o> <c-o>
	nnoremap g<c-i> <c-i>

	" built in search
	xnoremap g/ :action Find<cr>
	noremap g/ :action Find<cr>

	" Commands for shortcut conflicts
	sethandler <S-Tab> a:vim
	sethandler <A-Up> a:vim
	sethandler <A-Down> a:vim
	sethandler <C-;> a:vim
	sethandler <C-S-;> a:vim
	sethandler <C-A> a:vim
	sethandler <C-D> a:vim
	sethandler <C-E> a:vim
	sethandler <C-F> a:vim
	sethandler <C-G> a:vim
	sethandler <C-H> a:vim
	sethandler <C-J> a:vim
	sethandler <C-K> a:vim
	sethandler <C-L> a:vim
	sethandler <C-M> a:vim
	sethandler <C-P> a:vim
	sethandler <A-P> a:ide
	sethandler <C-R> a:vim
	sethandler <C-S> a:vim
	sethandler <C-T> a:vim
	sethandler <C-U> a:vim
	sethandler <C-V> a:vim
	sethandler <C-W> a:vim
	sethandler <A-X> a:ide
	" Commands for shortcut conflicts
endif
